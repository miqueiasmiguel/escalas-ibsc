generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Member {
  id          String   @id @default(uuid())
  name        String
  instruments String[]

  scaleAssociations ScaleMember[]
  unavailabilities  MemberUnavailability[]
  recurringUnavailabilities RecurringUnavailability[]
  requiresConfirmation Boolean              @default(false)

  @@map("members")
}

model MemberUnavailability {
  id       String   @id @default(uuid())
  memberId String
  member   Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  start    DateTime
  end      DateTime

  @@map("member_unavailabilities")
}

model RecurringUnavailability {
  id        String   @id @default(uuid())
  memberId  String
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  dayOfWeek Int // 0 = Domingo, 1 = Segunda, ..., 6 = SÃ¡bado

  @@map("recurring_unavailabilities")
}

model ScaleEntry {
  id      String   @id @default(uuid())
  date    String
  service String

  members ScaleMember[]

  @@map("scales")
}

model ScaleMember {
  id String @id @default(uuid())

  scaleId String
  scale   ScaleEntry @relation(fields: [scaleId], references: [id], onDelete: Cascade)

  memberId String?
  member   Member? @relation(fields: [memberId], references: [id], onDelete: Restrict)

  instrument String

  @@map("scale_members")
}

model ScaleTemplate {
  id                   String   @id @default(uuid())
  description          String
  dayOfWeek            Int // 0-6 (Sunday-Saturday)
  service              String // ServiceType
  requiresConfirmation Boolean  @default(false)
  instruments          String[]
  active               Boolean  @default(true)

  @@map("scale_templates")
}
